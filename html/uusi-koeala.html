<!DOCTYPE html>
<script src="../js/ipcRenderer.js"></script>

<html>
    <head>
        <title>YEE</title>
        <meta charset="UTF-8">
        <!--link rel="stylesheet" type="text/css" href="../css/Jylli.css">-->
    </head>

    <body>
        <h1>Uusi koeala</h1>
        <div>
            <label for="koeAlanNimi">Koealan nimi: </label>
            <input type="text" id="koeAlanNimi" name="koeAlanNimi"><br>

            <label for="koealatemplaatit">Valitse koealapohja:</label>
            <select name="koealatemplaatit" id="koealatemplaatit"> 
            </select> 

            <!--JOKU TEMPLATE PREVIEW-->

            <button onclick='luoAla()'>OK</button>
            <!--MIKSI PERUUTA-NAPPI TOIMII??-->
            <button onclick='render_page("Koekalastus")'>Peruuta</button>
        </div>
    </body>
</html>

<script>
    ipcRenderer.on("koekalastus-data" , (event, ipc_receive) => ipc_data = ipc_receive)
    ipcRenderer.on("data-for-renderer", (event, ipc_fetch, step) => {
        ipc_data = ipc_fetch
        console.log(ipc_data)

        switch(step) {
            case 1:
                fetchTemplateLinks
                break;
            case 2:
                createAla
                break;
            case 3:
                LinkAlaToKaominaisuudet
                break;
        }
        step++
    })

    let fetchTemplateLinks = () => {

        let fetch_sql = `SELECT * FROM link_koelalat_kaominaisuudet WHERE id_koealat = (SELECT (id) FROM koealat WHERE nimi = "${document.querySelector("#koealatemplaatit").value}")`
        ipcRenderer.send("fetch-data", fetch_sql, true)
    }

    let createAla = (ipcdata) => {
        let templatelinks = ipc_data

        insert_sql = `INSERT INTO koealat VALUES(null,'${document.querySelector("#koealanNimi").value}','${ipc_data["avain"]}' , false, false)`
        ipcRenderer.send("insert-data", insert_sql, true)
    }
    
    let LinkAlaToKaominaisuudet = (ipcdata) => {
        let koealanID = ipc_data

        let insert_sql2 = new Array[ipc_data.length]
        templatelinks.forEach(row => {insert_sql2[row] = `INSERT INTO link_koelalat_kaominaisuudet VALUES (${koealanID},${row[1]},${row[2]})`})
        insert_sql2.forEach(row => {ipcRenderer.send("insert-data", insert_sql[row], false)})
        render_page("koeala", koealanID)
    }

    //Sitten funktio jolla lähdetään eteenpäin koealaan

    let ipc_data = null
    let ipc_data = null
    let step = 1
    document.querySelector("#koealatemplaatit").innerHTML += "<br><option values='Köhniö'>Köhniö</option>"
    </script>